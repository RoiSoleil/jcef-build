name: JCEF Build
on:
   push:
      branches:
      - main
   pull_request:
      branches:
      - main
jobs:
   build:
      runs-on: windows-latest
      steps:
      -  name: Set up JDK 17
         uses: actions/setup-java@v2
         with:
            distribution: adopt
            java-version: 17
      -  name: Set up Python 3.7
         uses: actions/setup-python@v2
         with:
            python-version: 3.7
            architecture: x64
      -  name: Set up MS Build
         uses: microsoft/setup-msbuild@v1.1
      -  name: Build jcef-win64
         shell: bash
         run: |-
            export JCEF_DIR="$PWD/src"
            export PYTHON_EXECUTABLE=/c/hostedtoolcache/windows/Python/3.7.9/x64/python.exe
            git clone https://github.com/chromiumembedded/java-cef.git $JCEF_DIR
            mkdir -p $JCEF_DIR/jcef_build
            cd $JCEF_DIR/jcef_build
            cmake -G "Visual Studio 16" -A x64 ..
            msbuild.exe ALL_BUILD.vcxproj /property:Configuration=Release
            cd ../tools
            cmd /C "start ./make_distrib.bat win64"
      -  name: Zip jcef-win64
         uses: thedoctor0/zip-release@master
         with:
            type: zip
            filename: jcef-win64.zip
            directory: src/binary_distrib/win64/bin
      -  name: Release
         uses: marvinpinto/action-automatic-releases@latest
         with:
            repo_token: ${{ secrets.GITHUB_TOKEN }}
            automatic_release_tag: latest
            prerelease: true
            title: Development Build
            files: src/binary_distrib/win64/bin/jcef-win64.zip